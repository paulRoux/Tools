---
title: 解决锐捷校园网环境下VMware虚拟机无法上网问题
date: 2017/10/11
categories:
    - Tools
tags:
    - Tools
---

### 解决锐捷校园网环境下VMware虚拟机无法上网问题

#### 1.介绍：

- 在介绍笨方法之前首先得说一下VMware虚拟机无法上网的原因，虚拟机要想要上网主机里的VMnetDHCP和VMware NAT Service就必须要开启，可能很多人都没留意这个问题，因为这两个服务好像装好软件之后是默认开启的，在其他网络环境下虚拟机直接选择NAT方式就可以上网了，所以网上请教很多大牛时他们对我们的虚拟机无法上网感到非常费解呀。

- 不过在校园网的话，情况又不一样了，我不知道其他的校园网客户端有没有这种情况，可是使用锐捷校园网客户端的话会自动阻断VMware NAT Service服务的开启，也就是说即使你手动开启了VMware NAT Service过了一会又会被自动关闭，这样就导致不管在虚拟机里面怎么设置都无法上网（注意这里使用的NAT方式，或许其他连接方式有新的解决方法，这里只说NAT方式）。

- 如果有人对虚拟机的三种连接方式不是很了解的，可以看看这篇博客: <http://blog.csdn.net/collection4u/article/details/14127671> 。

- 那么知道是因为VMware NAT Service服务自动关闭的话解决的方法自然是让其一直打开，（VirtualBox在锐捷下都是可以上网的），最后想到使用windows批处理的方法，这其实真的是一个笨方法来的，只要写一个无限循序语句判断VMware NAT Service服务是否开启，没有开启就打开，一直循环判断，我试了一下效果，这样虚拟机是可以一直上网的，中间的断网也是不到1s，还是可以接受的，聊胜于无啦。

#### 2.笨方法1：
    (1)新建一个记事本文件，文件名后缀改成:.bat
    (2)用记事本打开或者其他编辑工具也可以
    (3)把下面的代码复制进去后保存：
```
@echo off
:first
for /f "skip=3 tokens=4" %%i in ('sc query "VMware NAT Service"') do set "zt=%%i" &goto :second

:second
if /i "%zt%"=="RUNNING" (
echo 该服务已经在运行
) else (
echo 该服务处于停止状态
net start "VMware NAT Service"
)
ping 127.0.0.1 -n 25>nul
goto :first
```

**注意格式，最好保持相同状态，保存退出。**

    (4)使用管理员权限打开该文件，然后让其一直运行不要关闭，直到你不使用虚拟机上网为止。
    (5)注意虚拟机VMware装好之后默认的就是NAT方式上网，打开了这个文件之后虚拟机不用做任何设置，如果你更改过，
    请到虚拟机的setting里面把连接方式改回NAT，网上很多关于设置这些的资料，可以去找找。


#### 3.笨办法2:

    (1)打开任务管理器，找到进程，第一个就是8021.exe然后结束此进程
    (2)打开VMware NAT Service服务，然后就不用管了，这样就可以直接上网

- **说明**：结束的8021的进程是锐捷客户端的进程，但是不影响锐捷客户端的上网功能，也就是说要不要这个进程都可以。

- 本内容只针对锐捷校园网下虚拟机无法上网问题、VMware NAT Service自动关闭情况做出的解决方法，有错漏之处或者有更好方法欢迎回复交流，希望以后有大牛可以解决锐捷自动关闭VMware NAT Service的问题笨方法解决锐捷校园网环境下VMware虚拟机无法上网问题（centos试用上网成功）

#### 4.笨办法3：
    (1)下载安装WinHex
    (2)修改客户端，把VMware NAT Service改成了MMware NAT Service的(或者你自己认为没用的都可以)，
    于是VMware NAT Service服务就不会被禁用了

#### 5.参考文章

- 说明：本人参考网上的文章，根据自己的经验与探索总结出此文章，内容有原创有转载。

- 链接：
<http://blog.sina.com.cn/s/blog_66cd08930102w28v.html#cmt_3092817>
